<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>FoodHub</title>
      <link rel="stylesheet" href="range.css">
      <link rel="stylesheet" href="semantic/dist/semantic.min.css">
	     <link rel="stylesheet" href="FoodHub.css">

       <!-- Leaflet stylesheet -->
       <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" /> -->
       <!-- Leaflet script -->
       <!-- <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script> -->

       <!-- Script for AutoComplete -->
       <script script type="text/javascript" src="AutoComplete.js"></script>

  </head>

  <body>

    <div id=sidebarUI class="ui fixed borderless secondary  menu">
        <a class="active item">
        <i class="align justify icon"></i>

        </a>
    </div>



    <div id="sidebar" class="ui sidebar top mobile only">
      <div class="ui segment">
      <div class="ui form" action="SelectMenu" method="get">
        <center><h1>Location</h1></center>
          <div id="filterOption">
            <label for="Location" id="titleFilterOptions">Your Location</label>
            <input type="text" id="mobileLocation" name="Location" placeholder="Location">
          </div>
          <label for="lname">Distance</label>
          <div class="ui segment">
            <div class="ui labeled range" id="range-0"></div>
          </div>

          <center><div id="separator"></div></center>
        <!--For the Cuisine we need to probably need to change these to be more specific-->




          <div class="ui segment">
            <center><h1>Filters</h1></center>
            <h5>Cuisine</h5>
              <select class="ui dropdown">
                <option value="0">Any</option>
                <option value="1">Japanese</option>
                <option value="2">American</option>
                <option value="3">Chinese</option>
                <option value="4">Thai</option>
                <option value="5">Greek</option>
                <option value="6">Indian</option>
                <option value="7">Italian</option>
                <option value="8">Mexican</option>
              </select>

            <div class="ui form" id="price-range">
              <h5>Price Range</h5>
              <div class="inline fields">
                <div class="field">
                  <div class="ui radio checkbox">
                    <input type="radio" name="frequency" checked="checked">
                    <label>Low</label>
                  </div>
                </div>
                <div class="field">
                  <div class="ui radio checkbox">
                    <input type="radio" name="frequency">
                    <label>Medium</label>
                  </div>
                </div>
                <div class="field">
                  <div class="ui radio checkbox">
                    <input type="radio" name="frequency">
                    <label>High</label>
                  </div>
                </div>
              </div>
            </div>
            <h5>Star Rating</h5>
            <div class="ui massive star rating" data-max-rating="5"></div>
            <div id="submitButton">
            <button class="ui blue button">Submit</button>
          </div>
          </div>
      </div>
    </div>
    </div>

    <!-- Start of header content ------------------------------------------------------------->

    <div class="pusher">
    <div class="ui padded grid">
      <div id="header">
        <!-- Logo -->
        <div id="logo">
            <img src= "Logo.png" id="SiteLogo"/>
        </div>
        <!-- User Icon -->
        <div class="right floated left aligned six wide column">
          <a href="FoodHub-Login.html">
            <img src= "user-icon.png" id="iconProperties"/>
          </a>
        </div>
      </div>

      <!-- End of header content ------------------------------------------------------------->

      <div id="sidebar" class="four wide computer column computer only">
        <div class="ui segment">
          <div class="ui form" action="SelectMenu" method="get">
            <center><h1>Location</h1></center>
              <div id="filterOption">
                <label for="Location" id="titleFilterOptions">Your Location</label>
                <input type="text" id="mainLocation" name="Location" placeholder="Location">
              </div>

              <label for="lname">Distance</label>
              <div class="ui segment">
                <div class="slidecontainer">
                  <input type="range" min="1" max="8047" value="50" id="distanceOption" class="slider">
                </div>

                <!-- <div class="ui labeled range">
                  <input type="range" min="1" max="8047" value="50" id="distanceOption">
                </div> -->
              </div>

              <center><div id="separator"></div></center>

              <div class="ui segment">
                <center><h1>Filters</h1></center>
                <h5>Cuisine</h5>
                  <select class="ui dropdown" id="cuisineOption">
                    <option value="0">Any</option>
                    <option value="1">Japanese</option>
                    <option value="2">American</option>
                    <option value="3">Chinese</option>
                    <option value="4">Thai</option>
                    <option value="5">Greek</option>
                    <option value="6">Indian</option>
                    <option value="7">Italian</option>
                    <option value="8">Mexican</option>
                  </select>

                <div class="ui form" id="price-range">
                  <h5>Price Range</h5>
                  <div class="inline fields">
                    <div class="field">
                      <div class="ui radio checkbox">
                        <input type="radio" name="priceOption" checked="checked" value="1">
                        <label>Low</label>
                      </div>
                    </div>
                    <div class="field">
                      <div class="ui radio checkbox">
                        <input type="radio" name="priceOption" value="2">
                        <label>Medium</label>
                      </div>
                    </div>
                    <div class="field">
                      <div class="ui radio checkbox">
                        <input type="radio" name="priceOption" value="3">
                        <label>High</label>
                      </div>
                    </div>
                  </div>
                </div>

                <h5> Star rating </h5>
                <div class="ui massive star rating" data-max-rating="5" data-id="ratingOption"></div>
              </div>

              <div id="submitButton">
              <button class="ui blue button" id="subButton">Submit</button>
            </div>

          </div>
        </div>

        <!-- Button used to show reviews for now as api has not been fully implemented -->
        <button id="showReviews">Show Reviews</button>
      </div>


      <!-- End of sidebar content ------------------------------------------------------------->


        <!-- Start of main content (Map and Reviews) -------------------------------------------->

      <div id="content" class="twelve wide computer sixteen wide mobile column">

        <div id="map">

        </div>
        <div id="reviews">
          <table id="reviewsTable">
            <thead>
            <tr>
              <th>Reviews</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td> This is where the reviews will pop up when you select a restaurant </p>
              </td>
            </tr>
            <tr>
              <td> Item 2.</td>
            </tr>
          </tbody>
        </table>
        </div>

        </div>


      </div>
      <!-- End of main content (Map and Reviews) ---------------------------------------------->
      <div id="footer">
        <a href="FoodHub-T&C.html" id="terms">Terms</a>
      </div>
    </div>


    <script src="js/konami.js"></script>
    <script type="text/javascript" src="http://helium-brave.8080.codio.io/Coursework/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="range.js"></script>
    <script type="text/javascript" src="semantic/dist/semantic.min.js"></script>
    <script type="text/javascript" src="http://helium-brave.8080.codio.io/Coursework/FoodhubFunctionality.js"></script>

    <!-- Script for Google AutoComplete and Map issue with separate scripts for api so combined however not doing the autocomplete -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDKmr5cGY2-bu4wHPpMSxsvrpH5XM6-Cps&libraries=places&callback=callFunctions" async defer></script>

    <!-- Script for Google Map -->
    <script>
    function callFunctions(){
      initialiseMap();
      initAutocomplete();
    }

    //Global Variables
    var map;
    var infowindow;
    var request;
    var service;
    var markers = [];
    var rating = 1;

    function initialiseMap() {

      //Chicago
      //var center = new google.maps.LatLng(41.8781,-87.6298);

      //New York
      var center = new google.maps.LatLng(40.7128,-74.0060);
      //Aberdeen
      //var center = new google.maps.LatLng(57.1497,-2.099075);

      map = new google.maps.Map(document.getElementById('map'),{
        center: center,
        zoom: 8
      });

      //var center = new google.maps.LatLng(57.1497,-2.099075);
      //map = new google.maps.Map(document.getElementById('map'),{
        //center: center,
        //zoom: 5
      //});

      //Finds Generic Restaurants
      request = {
        location: center,
        radius: 8047,
        types: ['restaurant'],
      };
      infowindow = new google.maps.InfoWindow();

      service = new google.maps.places.PlacesService(map);

      service.nearbySearch(request, callback);

      //Once Submit Button Hit -------------------------------------------------
      var button = document.getElementById('subButton');

      //Geocoder
      var geocoder = new google.maps.Geocoder();

      google.maps.event.addDomListener(button, 'click', function() {

        //Creates New Center
        var newCenter = new google.maps.LatLng(40.7128,-74.0060);
        clearResults(markers);

        //Location Option
        //var newCenter = new google.maps.LatLng(geocodeAddress(geocoder, map));
        //console.log(newCenter);

        //Distance Option
        var distance = document.getElementById('distanceOption');
        var userDistanceValue = distance.value;

        //Cuisine Option
        var cuisine = document.getElementById('cuisineOption');
        var userCuisineOption = cuisine.options[cuisine.selectedIndex].text;

        //Rating Option
        // $('.ui.rating').rating('setting', 'onRate', function(value) {
        //   rating = value;
        // });
        // console.log("outside: " + rating);
        // var userRatingOption = rating;
        // console.log(userRatingOption);

        //Price Option
        var price = document.getElementsByName('priceOption');

        for (var i = 0, length = price.length; i < length; i++){
         if (price[i].checked){
          var userPriceOption = price[i].value;
          var minPrice = userPriceOption - 1;
          break;
         }
        }

        //Search Request
        var request = {
          location: newCenter,
          radius: userDistanceValue,
          types: ['restaurant'],
          keyword: [userCuisineOption],
          minPriceLevel: minPrice,
          maxPriceLevel: userPriceOption,
          //rating: userRatingOption
        };
        service.nearbySearch(request, callback);
      })

    }

    //End of initialiseMap Function --------------------------------------------

    //CallBack Function
    function callback(results, status){
      if(status == google.maps.places.PlacesServiceStatus.OK){
        for (var i = 0; i < results.length; i++){
          //createMarker(results[i]);
          markers.push(createMarker(results[i]));
        }
      }
    }

    //Creates Marker
    function createMarker(place){
      var placeLoc = place.geometry.location;
      var marker = new google.maps.Marker({
        map: map,
        position: place.geometry.location

      });

      google.maps.event.addListener(marker, 'click', function(){
        //Displays Name of Restaurant
        infowindow.setContent(place.name);
        infowindow.open(map, this);
      });
      return marker;
    }

    //Clears the Results
    function clearResults(markers){
      for (var m in markers){
        markers[m].setMap(null)
      }
      markers = []
    }

    //Geocoder Function
    function geocodeAddress(geocoder, resultsMap) {
        var address = document.getElementById('mainLocation').value;
        var latitude;
        var longitude;

        geocoder.geocode( { 'address': address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            latitude = results[0].geometry.location.lat();
            longitude = results[0].geometry.location.lng();
            console.log(latitude);
            console.log(longitude);
          }
        });
        var newCenter = new google.maps.LatLng(latitude,longitude);
        console.log(newCenter)
        return newCenter;
      }

        //geocoder.geocode({'address': address}, function(results, status) {
          //if (status === 'OK') {
          //  resultsMap.setCenter(results[0].geometry.location);
          //  var latitude = results[0].geometry.location.latitude;
          //  var longitude = results[0].geometry.location.longitude;
          //  var marker = new google.maps.Marker({
          //    map: resultsMap,
          //    position: results[0].geometry.location
          //  });
        //  } else {
        //    alert('Geocode was not successful for the following reason: ' + status);
        //  }
      //  });
    //  }

    google.maps.event.addDomListener(window, 'load', initialiseMap);

    </script>






    <!-- <script>
    function initialiseMap() {

      //var start = document.getElementById("mainLocation").value;
      var center = new google.maps.LatLng(57.1497,-2.099075);
      map = new google.maps.Map(document.getElementById('map'),{
        center: center,
        zoom: 5
      });

      //var center = new google.maps.LatLng(57.1497,-2.099075);
      //map = new google.maps.Map(document.getElementById('map'),{
        //center: center,
        //zoom: 5
      //});

      //Finds restaurants
      request = {
        location: center,
        radius: 8047,
        types: ['restaurant'],
      };
      infowindow = new google.maps.InfoWindow();

      service = new google.maps.places.PlacesService(map);

      service.nearbySearch(request, callback);

      //Once Submit Button Hit
      var button = document.getElementById('subButton');

      google.maps.event.addDomListener(button, 'click', function() {
        var newCenter = new google.maps.LatLng(57.1497,-2.099075);
        clearResults(markers);

        //Cuisine Option
        var cuisine = document.getElementById("cuisineOption");
        var userCuisineOption = cuisine.options[cuisine.selectedIndex].text

        //Price Option
        //var ratingValue;

        //Search Request
        var request = {
          location: newCenter,
          radius: 8047,
          types: ['restaurant'],
          keyword: [userCuisineOption],
          //rating: [ratingValue]
        };
        service.nearbySearch(request, callback);
      })

    }

    function callback(results, status){
      if(status == google.maps.places.PlacesServiceStatus.OK){
        for (var i = 0; i < results.length; i++){
          var m = createMarker(results[i]);
          markers.push(m);
          //if (m){
          //markers.push(m);
          //}
        }
      }
    }

    function createMarker(place){
      //if (place.rating >= ratingValue){

        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });

        google.maps.event.addListener(marker, 'click', function(){
          infowindow.setContent(place.name);
          infowindow.open(map, this);
        });
        return marker;
      //}
      //return null;
    }

    function clearResults(markers){
      for (var m in markers){
        markers[m].setMap(null)
      }
      markers = []
    }

    google.maps.event.addDomListener(window, 'load', initialiseMap);

    </script> -->

    <!-- Script for Google Map API -->
    <!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDKmr5cGY2-bu4wHPpMSxsvrpH5XM6-Cps&callback=myMap"></script> -->

  </body>
</html>
